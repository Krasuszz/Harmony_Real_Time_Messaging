import router from '@ohos.router';//页面路由
import animator from '@ohos.animator';//ui动画
import prompt from '@ohos.prompt';//不知道是啥
import PreferencesUtil from '../common/database/PreferencesUtil';//数据库
import Logger from '../common/utils/Logger';//log
const TAG = '[Page_Login]';//log标识

@Entry @Component struct Login
{
  @State account: string = '';
  @State password: string = '';
  @State is_show_progress: boolean = false;
  private timeOutId = null;
  /**
   * In low-code mode, do not add anything to the build function, as it will be
   * overwritten by the content generated by the .visual file in the build phase.
   */
  build()
  {

  }
  change_account(value:string)
  {
    this.account = value;
  }
  change_password(value:string)
  {
    this.password = value;
  }
  assign()
  {
    if (this.account === '' || this.password === '')//是否为空
    {
      prompt.showToast({
        message: 'account or password is empty!'
      })
    }
    else PreferencesUtil.save_user_login(this.account, this.password);
  }
  login()
  {
    if (this.account === '' || this.password === '')//是否为空
    {
      prompt.showToast({
        message: 'account or password is empty!'
      })
    }
    else
    {
      prompt.showToast({
        message: 'checking database...'
      })
      PreferencesUtil.get_user_login(this.account).then((value) => {
        if(this.password === value)
        {
          prompt.showToast({
            message: 'logining...'
          })
          this.is_show_progress = true;
          if (this.timeOutId === null)
          {
            this.timeOutId = setTimeout(() => {
              this.is_show_progress = false;
              this.timeOutId = null;
              router.replace({ url: 'pages/Main' });
            }, 3);
          }
        }
        else
        {
          prompt.showToast({
            message: 'account or password is worn!'
          })
        }
        Logger.info(TAG, 'Get the value of user_login_password: ' + this.password);
      });

    }
  }
}